(t=>{try{class o{constructor(t){this.metrics={}}start(t){this.metrics[t="Client: "+t]||(this.metrics[t]={start:0,end:0,duration:0}),this.metrics[t].start=performance.now()}end(t){this.metrics[t="Client: "+t]&&(this.metrics[t].end=performance.now(),this.metrics[t].duration=this.metrics[t].end-this.metrics[t].start)}log(){var e,s=t.cmmvTelemetry;0<s?.length&&(e=this.metrics,this.metrics={},s.map((t=>this.metrics["Server: "+t.label]={start:t.startTime,end:t.endTime,duration:t.endTime-t.startTime})),this.metrics={...this.metrics,...e});let n=0;s=Object.keys(this.metrics).map((t=>{var e=this.metrics[t].duration;return n+=e,{Process:t,Duration:e.toFixed(2)+" ms"}})),"dev"===process.env.NODE_ENV&&console.table(s)}}var e={app:null,socket:null,contractIndex:{},contracts:{},context:{},contextApp:null,loaded:!1,binds:{},telemetry:new o,reconnectInterval:1e4,isAuth:!1,theme:"default",styleSettings:{},components:{},vuePlugins:[],methods:{},initialize(t,e,s,n,i){this.telemetry.start("Initialize Frontend"),this.methods=i;try{t.config&&t.config.rpc&&t.config.rpc.enabled&&!window.Vue&&(this.telemetry.start("WebSocket Initialization"),this.connectWebSocket(),this.telemetry.end("WebSocket Initialization"))}catch(t){console.error(t)}"object"==typeof t&&(this.context=Object.assign(this.context,t));var o,r={},c="default"!==this.theme?"."+this.theme:"",a=["get","load","refresh","theme","switch"];if("object"==typeof e)for(var h in this.styleSettings=Object.assign(this.styleSettings,e),this.styleSettings)for(var d in this.styleSettings[h])-1!==d.indexOf(c)&&(o=d.replace(c,""),r[h]||(r[h]={}),a.includes(o)||(r[h][o]=this.styleSettings[h][d]));if(s)for(var m in s){for(var l in this.components[m]={},s[m])s[m][l]&&"string"==typeof s[m][l]&&s[m][l].startsWith("function")?this.components[m][l]=new Function(`return (${s[m][l]})`)():this.components[m][l]=s[m][l];(this.components[m].$parent=this).components[m].$style=this.styles,this.components[m].$style.load()}n&&Array.isArray(n)&&(this.vuePlugins=n),document.addEventListener("DOMContentLoaded",(()=>{this.processExpressions(),this.telemetry.log()})),this.telemetry.end("Initialize Frontend")},connectWebSocket(){var t=window.location.href.replace("https","wss").replace("http","ws");this.socket=new WebSocket(t),this.socket.binaryType="arraybuffer",this.socket.addEventListener("message",this.parseMessage.bind(this)),this.socket.addEventListener("open",(()=>{this.telemetry.end("WebSocket Initialization")})),this.socket.addEventListener("close",(()=>{console.warn("WebSocket disconnected. Attempting to reconnect in 10 seconds..."),setTimeout((()=>{this.connectWebSocket()}),this.reconnectInterval)})),this.socket.addEventListener("error",(t=>{console.error("WebSocket error:",t)}))},addContracts(t){this.telemetry.start("Load Contracts");try{for(var e in this.contractIndex=t.index,t.contracts){var s;t.contracts.hasOwnProperty(e)&&(s=protobuf.Root.fromJSON(t.contracts[e]),this.contracts[e]=s)}this.generateRPCBindings()}catch(t){console.error("Error loading contracts:",t)}this.telemetry.end("Load Contracts")},getContract(t){return this.contracts[t]},parseMessage(t){this.telemetry.start("Parse Message");try{var e=t.data instanceof ArrayBuffer?new Uint8Array(t.data):t.data;let n=this.contracts.ws.lookupType("WsCall").decode(e),i=Object.keys(this.contractIndex).find((t=>this.contractIndex[t].index===n.contract));var s=Object.keys(this.contractIndex[i].types).find((t=>this.contractIndex[i].types[t]===n.message));if(i&&s){let e=this.getContract(i).lookupType(s).decode(n.data);this.binds[i]&&this.binds[i][s]&&this.binds[i][s].forEach((s=>s.apply(this.contextApp,[e,t.socket])))}else console.error("Unknown contract or message type:",n.contract,n.message)}catch(e){console.error(e)}this.telemetry.end("Parse Message")},pack(t,e,s){try{var n,i,o,r,c;return this.contracts[t]&&this.contractIndex[t]?(i=(n=this.contractIndex[t])?.types[e],r=(o=this.contracts[t]?.lookupType(e))&&s?o.encode(s).finish():null,(c=(this.contracts.ws?.lookupType("WsCall"))?.encode({contract:n?.index,message:i,data:r&&r instanceof Uint8Array?r:new Uint8Array}).finish())?new Uint8Array(c):null):(console.error(`Not found in contract list ${t}.`+e),null)}catch(t){console.error(t)}},generateRPCBindings(){Object.keys(cmmv.contracts).forEach((t=>{let e=cmmv.contracts[t];e.nested&&Object.keys(e.nested).forEach((s=>{(s=e.nested[s]).nested&&Object.keys(s.nested).forEach((e=>{-1<e.indexOf("Request")?cmmv[e]=s=>{e.startsWith("Add")?this.rpc.add(t,e,s):e.startsWith("Update")?this.rpc.update(t,e,s):e.startsWith("Delete")&&this.rpc.delete(t,e,{id:s})}:e.indexOf("Response")&&this[e]&&"function"==typeof this[e]&&this.rpc.on(t,e,this[e])}))}))}))},send(t){this.socket&&this.socket.readyState===WebSocket.OPEN?this.socket.send(t):console.warn("WebSocket is not open. Unable to send message.")},async processExpressions(){this.telemetry.start("Process Expressions"),this.telemetry.start("CreateApp"),this.styles.load();var e={...this.styles.refresh(),styleSettings:this.styleSettings};if(window.Vue){var s=(Vue||await import("/node_modules/vue/dist/vue.esm-bundler.js")).createApp;let a=Object.assign({},this.context);var n={};let h={};if("object"==typeof t.cmmvSetup.__methods)for(var i in t.cmmvSetup.__methods)n[i]=new Function(`return (${t.cmmvSetup.__methods[i]})`)();try{if(this.context.config.rpc.enabled){let t=(await import("/assets/rpc-mixins.js")).default;h={data:()=>({...a,...t.data?.()}),components:this.components,styles:e,$style:e,mounted(){"function"==typeof this.mounted&&this.mounted(),"function"==typeof t.mounted&&t.mounted.call(this)},created(){"function"==typeof this.created&&this.created(),"function"==typeof t.created&&t.created.call(this)},methods:{...n,...t.methods},...this.context}}else h={data:()=>({...a}),components:this.components,styles:e,$style:e,mounted:this.mounted,created:this.created,methods:{...n},...this.context}}catch{h={data:()=>({...a}),components:this.components,styles:e,$style:e,mounted(){"function"==typeof this.mounted&&this.mounted()},created(){"function"==typeof this.created&&this.created()},methods:{...n},...this.context}}var o=s(h);if(0<this.vuePlugins.length)for(var r in this.vuePlugins){var{plugin:r,config:c}=this.vuePlugins[r];r=await import(r.startsWith("@")?"/node_modules/"+r:r);c?(c=await import(c),o.use(r.default,c.default)):o.use(r)}o.mount("#app")}else this.contextApp=this.reactive({$template:"#app",components:this.components,...this,rpc:this.rpc,$rpc:this.rpc,styles:e,$style:e,...this.context,loaded:!0,mounted:this.mounted,created:this.created}),this.contextApp.styles.load(),s=this.createApp(this.contextApp),this.telemetry.end("CreateApp"),"function"==typeof this.contextApp?.created&&(this.telemetry.start("Created Hook"),this.contextApp?.created(),this.telemetry.end("Created Hook")),this.telemetry.start("Mount App"),this.app=s.mount("#app"),this.telemetry.end("Mount App");"function"==typeof this.contextApp?.mounted&&(this.telemetry.start("Mounted Hook"),this.contextApp?.mounted(),this.telemetry.end("Mounted Hook")),this.telemetry.end("Process Expressions")},rpc:{get(t,e){var s=this?.pack?this:cmmv;t=s.pack.call(s,t,e);s.send(t)},add(t,e,s){var n=this?.pack?this:cmmv;t=n.pack.call(n,t,e,{item:s});n.send(t)},update(t,e,s){var n=this?.pack?this:cmmv;t=n.pack.call(n,t,e,{id:s._id||s.id,item:s});n.send(t)},delete(t,e,s){var n=this?.pack?this:cmmv;t=n.pack.call(n,t,e,{id:s._id||s.id});n.send(t)},on(t,e,s){var n=this?.binds?this:cmmv;n.binds[t]||(n.binds[t]={}),n.binds[t][e]||(n.binds[t][e]=[]),n.binds[t][e].push(s)}},styles:{theme:"default",styleSettings:null,load(){var t=localStorage.getItem("theme")||"default";this.theme=t,this.refresh()},refresh(){var t,e,s="default"!==this.theme?"."+this.theme:"",n=["get","load","refresh","theme","switch"],i=this.styleSettings||cmmv.styleSettings;for(t in i)for(var o in i[t])-1===o.indexOf(s)&&"default"!==this.theme||(e=o.replace(s,""),this[t]||(this[t]={}),n.includes(e))||(this[t][e]=i[t][o]);return this},get(t){var e=t.split(".")[0];t=t.replace(e+".","")+("default"!==this.theme?"."+this.theme:"");return cmmv.styleSettings[e]&&cmmv.styleSettings[e][t]?cmmv.styleSettings[e][t]:""},switch(t){localStorage.setItem("theme",t),this.theme=t,this.refresh()}}};if(t.cmmvSetup){!t.cmmv&&window.Vue&&(t.cmmv=window.Vue),t.cmmv||(t.cmmv={});var s={};if("object"==typeof t.cmmvSetup.__methods)for(var n in t.cmmvSetup.__methods)s[n]=new Function(`return (${t.cmmvSetup.__methods[n]})`)();var i=t.cmmvSetup.__mounted?new Function(`return (${t.cmmvSetup.__mounted})`)():null;t.cmmv=Object.assign({...s,mounted:i},cmmv,t.cmmvSetup,e),t.cmmv.initialize(t.cmmvSetup.__data||{},t.cmmvSetup.__styles||{},t.cmmvSetup.__components||{},t.cmmvSetup.__vuePlugins||{},t.cmmvSetup.methods||{})}else t.cmmv=Object.assign({},e),t.cmmv.initialize({},{},{},{})}catch(e){console.error(e)}})("undefined"!=typeof window?window:global);